---
#Generated manifest
name: <%= p("cf.appname") %>
memory: <%= p("cf.appmemory") %>
instances: <%= p("cf.appinstances") %> # db-dumper-service handle n instances
path: /var/vcap/packages/db-dumper-pkg/db-dumper-service.war
host: <%= p("cf.appname") %>
domain: <%= p("cf.domain") %>
timeout: <%= p("cf.app_start_timeout") %>
env:
  spring_profiles_active: cloud,core,uaa
  logging_level_com_orange_clara_cloud_servicedbdumper: INFO # you can change the verbosity to: WARN, DEBUG, ERROR
  broker_username: <%= p("dbdumper.security.user.name") %>
  broker_password: <%= p("dbdumper.security.user.password") %>
  admin_username: <%= p("dbdumper.admin.username") %>
  admin_password: <%= p("dbdumper.admin.password") %>
  cf_admin_user: <%= p("dbdumper.cf.client.username") %>
  cf_admin_password: <%= p("dbdumper.cf.client.password") %>
  filer_type: <%= p("dbdumper.filer_type") %> # this is create a compressed dump and send to S3 -- other value is: S3 (this will send dump to S3 without compression)
  use_ssl: true # If you will be on https set this value to true
  CF_TARGET: https://uaa.<%= p("dbdumper.cf.client.target.host") %> # url of your uaa (set it if you want to also use uaa). This url is also used to download the TLS certificate and trust it as valid for the cloudcontroller URL
  cloud_controller_url: https://api.<%= p("dbdumper.cf.client.target.host") %> # url of your cloudfoundry api
  security_oauth2_client_clientId: <%= p("dbdumper.cf.client.clientId") %>
  security_oauth2_client_clientSecret: <%= p("dbdumper.cf.client.clientSecret") %>
  service_definition_id: <%= p("dbdumper.cf.service.broker.id") %> # your service broker name id for multi-db-dumper-service instances. Note db-dumper-cli-plugin leverages the default value "db-dumper-service" as default, avoid changing unless necessary
  # Cost definitions
  service_definition_is_free: <%= p("dbdumper.service_definition.is_free") %>
  service_definition_currency: <%= p("dbdumper.service_definition.currency") %>
  service_definition_cost_mb: <%= p("dbdumper.service_definition.cost_mb") %>
  service_definition_quota: <%= p("dbdumper.service_definition.quota") %>
  ## Formulas
  # (`quota` is for quota*service_definition_cost_mb price) formulas corresponding to each quota to calculate price
  # in following for 100mb the price will be 100mb*service_definition_cost_mb and for 1gb it will be 90% of 1gb*service_definition_cost_mb
  # If you set only one formula this formula will be played for all quota
  service_definition_cost_formulas: <%= p("dbdumper.service_definition.cost_formulas") %>
  # uncomment if you want to plug to a spring-boot-admin app (see: https://github.com/codecentric/spring-boot-admin)
  #spring_boot_admin_url: http://spring-boot-admin.your.url.com
  #spring_boot_admin_username: spring-boot-admin-user
  #spring_boot_admin_password: spring-boot-admin-password
  job_errored_delete_expiration_days: <%= p("dbdumper.job.errored_delete_expiration_days") %>
  job_finished_delete_expiration_minutes: <%= p("dbdumper.job.finished_delete_expiration_minutes") %>
  dump_delete_expiration_days: <%= p("dbdumper.dump_delete_expiration_days") %>
  encryption_key: <%= p("dbdumper.encryptionKey") %> # This encryption key is used to encrypt databases passwords in database
  #When you do not use uaa, dashboard use basic auth with a default user: user/password . Set and uncomment those env var to change name and password
  #user_username: user
  #user_password: password
  JAVA_OPTS: "-Djava.security.egd=file:/dev/urandom"
  JBP_CONFIG_CONTAINER_CERTIFICATE_TRUST_STORE: '{enabled: true}'
buildpack: java_buildpack
services:
- s3-dumps-bucket
- dbdumper-mysql

